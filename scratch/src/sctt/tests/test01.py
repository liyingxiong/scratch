from sctt.composite_tensile_test import CompositeTensileTest
from sctt.interpolater import CrackBridge, Interpolater
from quaducom.meso.homogenized_crack_bridge.elastic_matrix.hom_CB_elastic_mtrx \
    import CompositeCrackBridge
from sctt.crack_bridge_constant_bond import CrackBridgeConstantBond
from quaducom.meso.homogenized_crack_bridge.elastic_matrix.reinforcement \
    import ContinuousFibers
from stats.pdistrib.weibull_fibers_composite_distr import \
    WeibullFibers, fibers_MC
from spirrid.rv import RV
import numpy as np

def test01():
    reinf = ContinuousFibers(r=0.0035,
                          tau=RV('weibull_min', loc=0.0, shape=1., scale=4.),
                          V_f=0.01,
                          E_f=180e3,
                          xi=fibers_MC(m=2.0, sV0=0.003),
                          label='carbon',
                          n_int=100)
    
    model1 = CompositeCrackBridge(E_m=25e3,
                                 reinforcement_lst=[reinf],
                                 Ll=100.,
                                 Lr=100.,
                                 )

    CB_random = CrackBridge(ccb=model1)
    
    interp_random = Interpolater(cb=CB_random)
    
    ctt1 = CompositeTensileTest(xgrid = np.linspace(0, 100, 501),
                               mstrength = np.array(
                  [ 24.76556112,  24.84911334,  24.88073353,  24.86340468,
                    24.8047707 ,  24.71617777,  24.61180218,  24.50777456,
                    24.42108606,  24.36810484,  24.36271929,  24.41436522,
                    24.52636471,  24.69502106,  24.90976223,  25.15436838,
                    25.4090629 ,  25.65307283,  25.86721941,  26.03615527,
                    26.14997404,  26.20503201,  26.20392349,  26.15465034,
                    26.06913251,  25.96131355,  25.84519168,  25.73311484,
                    25.63460145,  25.55580526,  25.49958474,  25.46601399,
                    25.45312002,  25.45764424,  25.47567871,  25.50308945,
                    25.53569316,  25.56920031,  25.59898765,  25.61981464,
                    25.62564352,  25.60973324,  25.56513809,  25.48564362,
                    25.36703352,  25.20843568,  25.01339357,  24.79029621,
                    24.55190781,  24.31396033,  24.09305293,  23.90434559,
                    23.75963137,  23.6662571 ,  23.62705595,  23.6410732 ,
                    23.70458282,  23.8118522 ,  23.95535162,  24.12551881,
                    24.31056234,  24.49691345,  24.67070863,  24.82018582,
                    24.93832762,  25.02476357,  25.08603248,  25.13381513,
                    25.18148196,  25.23996536,  25.31427581,  25.40180522,
                    25.49296187,  25.57389378,  25.63038172,  25.65165749,
                    25.63301926,  25.57659368,  25.49023349,  25.38510739,
                    25.27286095,  25.1632345 ,  25.06276104,  24.97474897,
                    24.90033458,  24.84008144,  24.79549086,  24.76987443,
                    24.76828173,  24.79648895,  24.85934064,  24.95891826,
                    25.09304611,  25.25454942,  25.431487  ,  25.60836327,
                    25.76811987,  25.89455936,  25.97476842,  26.00109728,
                    25.97232049,  25.89374997,  25.77628398,  25.63460488,
                    25.48492657,  25.34277086,  25.22119403,  25.12970297,
                    25.07387243,  25.05548379,  25.07292425,  25.12163253,
                    25.19451164,  25.28236891,  25.37451724,  25.45963308,
                    25.52684121,  25.56684897,  25.57286495,  25.54106451,
                    25.47050196,  25.36256635,  25.22024006,  25.04747833,
                    24.84895238,  24.63021895,  24.3981707 ,  24.16147007,
                    23.93063212,  23.71751397,  23.53416046,  23.39117422,
                    23.29596008,  23.25127964,  23.25451382,  23.29788287,
                    23.36964823,  23.456081  ,  23.54379808,  23.62198003,
                    23.68402977,  23.72838177,  23.7583766 ,  23.7813158 ,
                    23.80694365,  23.84565396,  23.90670121,  23.9966496 ,
                    24.11824881,  24.26989595,  24.44579967,  24.63688431,
                    24.83233738,  25.02154153,  25.19599429,  25.35077092,
                    25.4851668 ,  25.60235376,  25.70813981,  25.80915469,
                    25.91091876,  26.01625549,  26.12439444,  26.23092207,
                    26.32853495,  26.40838205,  26.46168219,  26.48127733,
                    26.46283223,  26.40549042,  26.31192674,  26.18785868,
                    26.04117407,  25.88087509,  25.71603585,  25.55493225,
                    25.40444571,  25.26978991,  25.15455556,  25.06102409,
                    24.99065125,  24.94457941,  24.92401465,  24.93031502,
                    24.96469634,  25.02755875,  25.11755375,  25.2306167 ,
                    25.35925614,  25.49239771,  25.61601736,  25.71466041,
                    25.77374322,  25.78230051,  25.7356293 ,  25.63716601,
                    25.49897937,  25.34050717,  25.18557206,  25.0581804 ,
                    24.97799694,  24.95655572,  24.99514168,  25.08487374,
                    25.20895394,  25.34649003,  25.47691907,  25.58396501,
                    25.65826765,  25.69823821,  25.709188  ,  25.70119273,
                    25.6863886 ,  25.67641403,  25.68054162,  25.70476656,
                    25.75181882,  25.82182054,  25.91317764,  26.02329124,
                    26.1488026 ,  26.28530628,  26.42671544,  26.56465962,
                    26.68836055,  26.7853249 ,  26.84293249,  26.85066637,
                    26.80244283,  26.69837636,  26.5454111 ,  26.35655305,
                    26.14884339,  25.94058213,  25.74851158,  25.58563654,
                    25.46011064,  25.37525866,  25.33046465,  25.32244814,
                    25.34643574,  25.39688364,  25.46765167,  25.55176686,
                    25.64106987,  25.72607046,  25.79625236,  25.84090544,
                    25.85037734,  25.81748848,  25.7387778 ,  25.61526938,
                    25.45255147,  25.26011591,  25.05006475,  24.83541478,
                    24.62829463,  24.4383263 ,  24.27143408,  24.12924162,
                    24.00912586,  23.90490168,  23.80802449,  23.70912423,
                    23.59963682,  23.47328761,  23.32721121,  23.16255934,
                    22.98453947,  22.80191872,  22.62610065,  22.46992791,
                    22.34637448,  22.26728026,  22.24225595,  22.27785791,
                    22.37710275,  22.53935839,  22.76060815,  23.03403786,
                    23.35084635,  23.70114154,  24.0747632 ,  24.46188327,
                    24.85327705,  25.24022822,  25.61412194,  25.96587148,
                    26.28539816,  26.56141383,  26.78172258,  26.93415763,
                    27.00811446,  26.99646274,  26.8974719 ,  26.71630647,
                    26.46567481,  26.16534831,  25.84048491,  25.51893911,
                    25.22796539,  24.99086263,  24.82413831,  24.73567254,
                    24.7241705 ,  24.77993922,  24.88678165,  25.02461132,
                    25.17230543,  25.31033218,  25.4228029 ,  25.49876074,
                    25.53268345,  25.52429943,  25.47787683,  25.40114925,
                    25.30401216,  25.19709132,  25.0902789 ,  24.99135415,
                    24.90484744,  24.83134436,  24.76741554,  24.70628625,
                    24.63921608,  24.55737849,  24.45387072,  24.32540729,
                    24.17330165,  24.00350515,  23.82570517,  23.65170184,
                    23.49341813,  23.3609297 ,  23.26084477,  23.19526462,
                    23.16145911,  23.15230444,  23.15744893,  23.1650741 ,
                    23.16400625,  23.14583316,  23.10663225,  23.0479586 ,
                    22.97687096,  22.90496805,  22.84660339,  22.81660048,
                    22.82786464,  22.88928178,  23.00422558,  23.16988822,
                    23.37752144,  23.61354366,  23.86133847,  24.10345736,
                    24.32386878,  24.50988289,  24.65344566,  24.75163008,
                    24.80632285,  24.82327337,  24.81078681,  24.7783673 ,
                    24.73555804,  24.69109834,  24.65238215,  24.62510832,
                    24.61300002,  24.6175379 ,  24.63776609,  24.67032827,
                    24.70991851,  24.75025388,  24.78550989,  24.81196447,
                    24.8294469 ,  24.8421494 ,  24.8584646 ,  24.88973503,
                    24.94808061,  25.04373131,  25.18244806,  25.36362848,
                    25.5795525 ,  25.81596104,  26.05384864,  26.27207729,
                    26.45025136,  26.5712862 ,  26.62323899,  26.60020216,
                    26.50230214,  26.33502117,  26.10813206,  25.8344986 ,
                    25.52890064,  25.20694485,  24.88406188,  24.57458676,
                    24.29095003,  24.04304603,  23.83786147,  23.6794253 ,
                    23.56909201,  23.50610533,  23.48833479,  23.51304501,
                    23.57755062,  23.67963021,  23.81760821,  23.990065  ,
                    24.19520156,  24.42996195,  24.6891014 ,  24.96445605,
                    25.24469405,  25.51577824,  25.76223051,  25.96908697,
                    26.12421257,  26.22048478,  26.25731268,  26.24107105,
                    26.18426542,  26.10355038,  26.01700679,  25.94125861,
                    25.8890338 ,  25.8676357 ,  25.87854033,  25.91804195,
                    25.97863088,  26.05065532,  26.12384376,  26.1884038 ,
                    26.23562463,  26.25810021,  26.24980261,  26.20623456,
                    26.12479628,  26.00535564,  25.85087584,  25.66786627,
                    25.46641059,  25.25958457,  25.06219596,  24.8889297 ,
                    24.7521455 ,  24.6597023 ,  24.61325379,  24.60742671,
                    24.63016675,  24.66431713,  24.69024289,  24.68908247,
                    24.64605646,  24.55322904,  24.41120703,  24.2294516 ,
                    24.02512542,  23.82065198,  23.64038099,  23.50689561,
                    23.43755046,  23.44178865,  23.51966037,  23.66177874,
                    23.85072316,  24.06366917,  24.27583037,  24.46416343,
                    24.610749  ,  24.70532068,  24.74656411,  24.74200901,
                    24.70655865,  24.65990073,  24.62319998,  24.61557791,
                    24.65093363,  24.73563574,  24.8675153 ,  25.036386  ,
                    25.22603848,  25.41733206,  25.59173366,  25.73451032,
                    25.83684547,  25.89641623,  25.91638718,  25.90321088,
                    25.86394591,  25.80390011,  25.7252557 ,  25.62699067,
                    25.50600347,  25.35901372,  25.18464715,  24.98514697,  
                    24.76732771]),
                                   interp=interp_random,
                                   crack_list=[],
                                   maxload=35.)
    avg_strain = ctt1.stress_strain_diagram()[1]
    
    assert np.allclose(avg_strain,  
      [  0.00000000e+00,   1.40000000e-05,   2.80000000e-05,
         4.20000000e-05,   5.60000000e-05,   7.00000000e-05,
         8.40000000e-05,   9.80000000e-05,   1.12000000e-04,
         1.26000000e-04,   1.40000000e-04,   1.54000000e-04,
         1.68000000e-04,   1.82000000e-04,   1.96000000e-04,
         2.10000000e-04,   2.24000000e-04,   2.38000000e-04,
         2.52000000e-04,   2.66000000e-04,   2.80000000e-04,
         2.94000000e-04,   3.08000000e-04,   3.22000000e-04,
         3.36000000e-04,   3.50000000e-04,   3.64000000e-04,
         3.78000000e-04,   3.92000000e-04,   4.06000000e-04,
         4.20000000e-04,   4.34000000e-04,   4.48000000e-04,
         4.62000000e-04,   4.76000000e-04,   4.90000000e-04,
         5.04000000e-04,   5.18000000e-04,   5.32000000e-04,
         5.46000000e-04,   5.60000000e-04,   5.74000000e-04,
         5.88000000e-04,   6.02000000e-04,   6.16000000e-04,
         6.30000000e-04,   6.44000000e-04,   6.58000000e-04,
         6.72000000e-04,   6.86000000e-04,   7.00000000e-04,
         7.14000000e-04,   7.28000000e-04,   7.42000000e-04,
         7.56000000e-04,   7.70000000e-04,   7.84000000e-04,
         7.98000000e-04,   8.12000000e-04,   8.26000000e-04,
         8.40000000e-04,   8.54000000e-04,   8.68000000e-04,
         8.82000000e-04,   2.10227420e-03,   2.15034410e-03,
         2.18347982e-03,   3.40911184e-03,   4.55584211e-03,
         5.58019872e-03,   6.81027062e-03,   6.96400869e-03,
         7.82187304e-03,   7.96035059e-03,   8.06987750e-03,
         9.07737156e-03,   9.27014306e-03,   9.74847171e-03,
         9.91229237e-03,   1.00399080e-02,   1.01675236e-02,
         1.02951392e-02,   1.04227548e-02,   1.05503704e-02,
         1.06779860e-02,   1.08057994e-02,   1.09338535e-02,
         1.16366621e-02,   1.17876251e-02,   1.21253943e-02,
         1.28637696e-02,   1.34904968e-02,   1.37012941e-02,
         1.38512391e-02,   1.40011842e-02,   1.41511293e-02,
         1.43010743e-02,   1.44510194e-02,   1.50854127e-02,
         1.52927259e-02,   1.54489481e-02])
    
    model2 = CrackBridgeConstantBond(T = 80.,
                                    E_m = 25e3,
                                    E_r = 180e3,
                                    v_r = 0.05)
    
    CB_constant = CrackBridge(ccb=model2)
    
    interp_constant = Interpolater(cb=CB_constant)

    ctt2 = CompositeTensileTest(xgrid = np.linspace(0, 100, 201),
                               mstrength = np.array(
                  [ 24.48308021,  24.17911779,  24.13299083,  24.32705351,
        24.6264534 ,  24.82303314,  24.74039541,  24.35155233,
        23.80737415,  23.33441077,  23.08313741,  23.06721277,
        23.22692182,  23.51390379,  23.90791804,  24.36900479,
        24.79077504,  25.02508878,  24.98338138,  24.74594657,
        24.57881479,  24.77692481,  25.40194414,  26.18394637,
        26.74831162,  26.92945645,  26.83665131,  26.68929627,
        26.65821645,  26.8113602 ,  27.11577482,  27.45141088,
        27.64283761,  27.53018842,  27.04829411,  26.25204993,
        25.28737054,  24.3461152 ,  23.61653737,  23.2343871 ,
        23.24419843,  23.57700352,  24.06264401,  24.48654647,
        24.67594913,  24.58577189,  24.3337556 ,  24.14607803,
        24.23271766,  24.66229721,  25.32167385,  25.98702865,
        26.44361372,  26.58546443,  26.45183735,  26.16985931,
        25.85235278,  25.55070872,  25.2700121 ,  24.98630377,
        24.66572488,  24.30380988,  23.95254653,  23.71342463,
        23.68954881,  23.87938838,  24.10385826,  24.13860135,
        23.97686719,  23.87736004,  24.08840377,  24.5903218 ,
        25.1449034 ,  25.5210235 ,  25.63789498,  25.55440919,
        25.37428555,  25.16288381,  24.9362816 ,  24.69865374,
        24.46255288,  24.25373203,  24.13839841,  24.2225524 ,
        24.56307844,  25.0763397 ,  25.56745361,  25.87099791,
        25.98938739,  26.08373808,  26.27365962,  26.45361058,
        26.36990845,  25.87705932,  25.07589727,  24.2177474 ,
        23.52644633,  23.11273179,  22.99407158,  23.13294487,
        23.45475559,  23.86357998,  24.25631195,  24.53628603,
        24.64378436,  24.58777989,  24.45310937,  24.3823323 ,
        24.52203243,  24.92868846,  25.49266401,  25.97769779,
        26.18101206,  26.06243146,  25.72644364,  25.33514652,
        25.04779269,  24.96763711,  25.09114697,  25.31856272,
        25.54947512,  25.78917554,  26.13096768,  26.59553076,
        27.02601045,  27.20375992,  27.05358088,  26.69410687,
        26.30477605,  25.98557358,  25.74427114,  25.57283974,
        25.48516081,  25.47364594,  25.48197579,  25.46860378,
        25.48005166,  25.62428991,  25.95406378,  26.36161286,
        26.61254107,  26.53456491,  26.14965526,  25.58213039,
        24.91962102,  24.25529408,  23.78302045,  23.69119485,
        23.94942671,  24.31205911,  24.5536455 ,  24.62338104,
        24.60479144,  24.64632961,  24.89166967,  25.32657695,
        25.70222518,  25.74416271,  25.44691368,  25.06559609,
        24.83202699,  24.77691847,  24.79933813,  24.77665421,
        24.5997768 ,  24.24385896,  23.87010347,  23.75875879,
        24.05454561,  24.61112415,  25.13760003,  25.4764081 ,
        25.69151128,  25.90696206,  26.13876921,  26.30639627,
        26.343004  ,  26.25110704,  26.08588359,  25.91875447,
        25.78554165,  25.63769723,  25.38599222,  25.03264357,
        24.71923155,  24.59473392,  24.65429921,  24.75260315,
        24.77504273,  24.75961968,  24.84533564,  25.11440995,
        25.4710194 ,  25.67538136,  25.54299902,  25.13922711,
        24.75326324,  24.64724944,  24.82471052,  25.05149967,  25.09773906]),
                                   interp=interp_constant,
                                   crack_list=[],
                                   maxload=35.)
    
    avg_strain2 = ctt2.stress_strain_diagram()[1]
        
    assert np.allclose(avg_strain2, 
      [  0.00000000e+00,   1.40000000e-05,   2.80000000e-05,
         4.20000000e-05,   5.60000000e-05,   7.00000000e-05,
         8.40000000e-05,   9.80000000e-05,   1.12000000e-04,
         1.26000000e-04,   1.40000000e-04,   1.54000000e-04,
         1.68000000e-04,   1.82000000e-04,   1.96000000e-04,
         2.10000000e-04,   2.24000000e-04,   2.38000000e-04,
         2.52000000e-04,   2.66000000e-04,   2.80000000e-04,
         2.94000000e-04,   3.08000000e-04,   3.22000000e-04,
         3.36000000e-04,   3.50000000e-04,   3.64000000e-04,
         3.78000000e-04,   3.92000000e-04,   4.06000000e-04,
         4.20000000e-04,   4.34000000e-04,   4.48000000e-04,
         4.62000000e-04,   4.76000000e-04,   4.90000000e-04,
         5.04000000e-04,   5.18000000e-04,   5.32000000e-04,
         5.46000000e-04,   5.60000000e-04,   5.74000000e-04,
         5.88000000e-04,   6.02000000e-04,   6.16000000e-04,
         6.30000000e-04,   6.44000000e-04,   6.58000000e-04,
         6.72000000e-04,   6.86000000e-04,   7.00000000e-04,
         7.14000000e-04,   7.28000000e-04,   7.42000000e-04,
         7.56000000e-04,   7.70000000e-04,   7.84000000e-04,
         7.98000000e-04,   8.12000000e-04,   8.26000000e-04,
         8.40000000e-04,   8.54000000e-04,   8.68000000e-04,
         8.82000000e-04,   8.96000000e-04,   9.10000000e-04,
         7.57866479e-03,   8.56771732e-03,   9.62006227e-03,
         1.08803966e-02,   1.18963317e-02,   1.29511301e-02,
         1.41603623e-02,   1.55798313e-02,   1.63174009e-02,
         1.75381169e-02,   1.88708247e-02,   2.11500704e-02,
         2.15384000e-02,   2.19052000e-02,   2.22720000e-02,
         2.26388000e-02,   2.30056000e-02,   2.33724000e-02,
         2.37392000e-02,   2.41060000e-02,   2.44728000e-02,
         2.48396000e-02,   2.52064000e-02,   2.55732000e-02,
         2.59400000e-02,   2.63068000e-02,   2.66736000e-02,
         2.70404000e-02,   2.74072000e-02,   2.77740000e-02,
         2.81408000e-02,   2.85076000e-02,   2.88744000e-02,
         2.92412000e-02,   2.96080000e-02])

if __name__ == '__main__':
    
    test01()

